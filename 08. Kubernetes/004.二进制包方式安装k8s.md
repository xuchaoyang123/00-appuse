<!--
 * @Author: your name
 * @Date: 2021-05-09 21:29:49
 * @LastEditTime: 2021-05-28 18:38:44
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: /01-good/use/08. Kubernetes/003.kubeadm方式部署k8s.md
-->

> ## 二进制包方式安装 k8s

#

### 1.平台规划

|    角色    |      ip       |                            组件                            |
| :--------: | :-----------: | :--------------------------------------------------------: |
| k8s-master | 192.168.31.71 | kube-apiserver,kube-controller-manager,kube-scheduler,etcd |
| k8s-node1  | 192.168.31.72 |               kubelet,kube-proxy,docker,etcd               |
| k8s-node2  | 192.168.31.73 |               kubelet,kube-proxy,docker,etcd               |

#

### 2.服务器初始化

```bash


#1.[所有节点] 关闭防火墙
	systemctl stop firewalld
	systemctl disable firewalld


#2.[所有节点] 关闭seliunx
	sed -i 's/enforcing/disabled/' /etc/seliunx/config #永久
	setenforce 0 #临时


#3.[所有节点] 关闭swap
	swapoff -a  #临时
	sed -ri 's/.*swap.*/#&/' /etc/fstab #永久


#4.[所有节点] 根据规划设置主机名
	hostnamectl set-hostname master
	hostnamectl set-hostname node1
	hostnamectl set-hostname node2


#5.[master节点] 在master添加hosts
	cat >> /etc/hosts <<EOF
	192.168.44.141 master
	192.168.44.142 node1
	192.168.44.143 node2
	EOF


#6.[所有节点] 将桥接的ipv4流量传递到iptables的链
	cat > /etc/sysctl.d/k8s.conf <<EOF
	net.bridge.bridge-nf-call-ip6tables=1
	net.bridge.bridge-nf-call-iptables=1
	EOF
	sysctl --system  #生效



#7.[所有节点] 时间同步
	yum install ntpdate -y
	ntpdate time.windos.com


#8.[所有节点]配置阿里云yum源

        cat <<EOF > kubernetes.repo
        [kubernetes]
        name=Kubernetes
        baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
        enabled=1
        gpgcheck=1
        repo_gpgcheck=1
        gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
        EOF

```

### 3.为 etcd 和 apiserver 自签证书

```bash

```

### 4.部署 etcd 集群

```bash

```

### 5.部署 master 组件

```bash

```

### 6.部署 node 组件

```bash

```

### 7.部署集群网络

```bash

```
